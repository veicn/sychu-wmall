"use strict";var app=getApp();Page({data:{lastPage:0,currentPage:1,orderList:null},onShareAppMessage:null,onReachBottom:function(){if(this.data.currentPage>=this.data.lastPage)return app.showToast("已经最后一页","none");this.orderList(++this.data.currentPage)},orderDetail:function(t){var e=t.currentTarget.dataset.id;app.redirect("/pages/user/order-details/index?id="+e,"navigateTo")},cancelOrderTap:function(t){var e=this,a=t.currentTarget.dataset.id;wx.showModal({title:"确定要取消该订单吗？",content:"",success:function(t){t.confirm&&app.wxRequest("/order/cancelOrder",{oid:a},function(t){1==t.code?(app.showToast("取消订单成功","success"),e.orderList(1)):app.showToast("取消订单失败","none")})}})},toPayTap:function(t){var e=t.currentTarget.dataset.id;app.wxPay(e,"/pages/user/order-list/index")},orderList:function(t){var e=this;t=t||1,app.wxRequest("/order/userOrders",{page:t},function(a){var r=a.data;1==a.code?1==t?e.setData({orderList:r.list,lastPage:r.lastPage,currentPage:r.currentPage}):e.setData({orderList:e.data.orderList.concat(r.list),lastPage:r.lastPage,currentPage:r.currentPage}):e.setData({orderList:null,lastPage:0,currentPage:1})})},onLoad:function(){this.orderList(1)}});