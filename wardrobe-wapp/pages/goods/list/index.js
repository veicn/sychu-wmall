"use strict";var app=getApp();Page({data:{indicatorDots:!0,autoplay:!0,interval:3e3,duration:1e3,loadingHidden:!1,userInfo:{},selectCurrent:0,goods:[],scrollTop:"0",loadingMoreHidden:!0,lastPage:0,currentPage:1,styleValue:"",styleIndex:0,styleList:[],categoryValue:"",categoryIndex:0,categoryList:[],materialValue:"",materialIndex:0,materialList:[],isShowFilter:!1},getStyleList:function(){var t=this;app.wxRequest("/dict/getDicts",{dictName:"COMM_STYLE"},function(a){1==a.code?t.setData({styleList:a.data.dicts}):app.showToast(a.message||"获取字典失败")})},bindStyleTap:function(t){var a=t.currentTarget.dataset,e=this.data.styleList[a.index];e.selected=!e.selected,this.setData({styleIndex:a.index,styleValue:a.id,styleList:this.data.styleList})},getCategoryList:function(){var t=this;app.wxRequest("/dict/getDicts",{dictName:"COMM_CATEGORY"},function(a){1==a.code?t.setData({categoryList:a.data.dicts}):app.showToast(a.message||"获取字典失败")})},bindCategoryTap:function(t){var a=t.currentTarget.dataset,e=this.data.categoryList[a.index];e.selected=!e.selected,this.setData({categoryIndex:a.index,categoryValue:a.id,categoryList:this.data.categoryList})},getMaterialList:function(){var t=this;app.wxRequest("/dict/getDicts",{dictName:"COMM_MATERIAL"},function(a){1==a.code?t.setData({materialList:a.data.dicts}):app.showToast(a.message||"获取字典失败")})},bindMaterialTap:function(t){var a=t.currentTarget.dataset,e=this.data.materialList[a.index];e.selected=!e.selected,this.setData({materialIndex:a.index,materialValue:a.id,materialList:this.data.materialList})},getSelectedItems:function(){for(var t=[],a=0;a<this.data.styleList.length;a++)this.data.styleList[a].selected&&t.push(this.data.styleList[a].dictId);for(var e=[],s=0;s<this.data.categoryList.length;s++)this.data.categoryList[s].selected&&e.push(this.data.categoryList[s].dictId);for(var i=[],o=0;o<this.data.materialList.length;o++)this.data.materialList[o].selected&&i.push(this.data.materialList[o].dictId);return{category:e.length>0?","+e.join(",|,")+",":"",style:t.length>0?","+t.join(",|,")+",":"",material:i.length>0?","+i.join(",|,")+",":""}},clearSelectedItems:function(){for(var t=0;t<this.data.styleList.length;t++)this.data.styleList[t].selected=!1;for(var a=0;a<this.data.categoryList.length;a++)this.data.categoryList[a].selected=!1;for(var e=0;e<this.data.materialList.length;e++)this.data.materialList[e].selected=!1;this.setData({styleList:this.data.styleList,categoryList:this.data.categoryList,materialList:this.data.materialList})},bindConfirmTap:function(){this.getGoodsList(1),this.setData({isShowFilter:!1})},bindResetTap:function(){this.clearSelectedItems(),this.getGoodsList(1),this.setData({isShowFilter:!1})},bindFilterTap:function(){this.setData({isShowFilter:!0})},toDetailsTap:function(t){app.redirect("/pages/goods/details/index?id="+t.currentTarget.dataset.id,"navigateTo")},onReachBottom:function(){if(this.data.currentPage>=this.data.lastPage)return app.showToast("已经最后一页","none");this.getGoodsList(++this.data.currentPage)},onLoad:function(){this.getCategoryList(),this.getStyleList(),this.getMaterialList(),this.getGoodsList(1)},addShopFavorite:function(t){var a=this,e=t.currentTarget.dataset.id;app.wxRequest("/user/saveCollection",{cid:e},function(t){1==t.code?(a.data.goods.forEach(function(t){t.cid==e&&(t.collection=1)}),a.setData({goods:a.data.goods})):app.showToast(t.message||"添加收藏失败")})},removeShopFavorite:function(t){var a=this,e=t.currentTarget.dataset.id;app.wxRequest("/user/cancelCollection",{cid:e},function(t){1==t.code?(a.data.goods.forEach(function(t){t.cid==e&&(t.collection=2)}),a.setData({goods:a.data.goods})):app.showToast(t.message||"移除收藏失败")})},getGoodsList:function(t){var a=this,e=a.getSelectedItems();e.page=t||1,app.wxRequest("/commodity/index",e,function(t){var s=t.data;1==t.code?1==e.page?a.setData({goods:s.list,lastPage:s.lastPage,currentPage:s.currentPage}):a.setData({goods:a.data.goods.concat(s.list),lastPage:s.lastPage,currentPage:s.currentPage}):(a.setData({goods:[],lastPage:0,currentPage:1}),app.showToast(t.message||"获取商品列表失败"))})}});