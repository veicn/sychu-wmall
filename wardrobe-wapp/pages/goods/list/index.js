"use strict";var app=getApp();Page({data:{indicatorDots:!0,autoplay:!0,interval:3e3,duration:1e3,loadingHidden:!1,userInfo:{},selectCurrent:0,goods:[],scrollTop:"0",loadingMoreHidden:!0,lastPage:0,currentPage:1,styleValue:"",styleIndex:0,styleList:[],categoryValue:"",categoryIndex:0,categoryList:[],materialValue:"",materialIndex:0,materialList:[],isShowFilter:!1},getStyleList:function(){var t=this;app.wxRequest("/dict/getDicts",{dictName:"COMM_STYLE"},function(e){t.setData({styleList:e.data.dicts})})},bindStyleTap:function(t){var e=t.currentTarget.dataset,a=this.data.styleList[e.index];a.selected=!a.selected,this.setData({styleIndex:e.index,styleValue:e.id,styleList:this.data.styleList})},getCategoryList:function(){var t=this;app.wxRequest("/dict/getDicts",{dictName:"COMM_CATEGORY"},function(e){t.setData({categoryList:e.data.dicts})})},bindCategoryTap:function(t){var e=t.currentTarget.dataset,a=this.data.categoryList[e.index];a.selected=!a.selected,this.setData({categoryIndex:e.index,categoryValue:e.id,categoryList:this.data.categoryList})},getMaterialList:function(){var t=this;app.wxRequest("/dict/getDicts",{dictName:"COMM_MATERIAL"},function(e){t.setData({materialList:e.data.dicts})})},bindMaterialTap:function(t){var e=t.currentTarget.dataset,a=this.data.materialList[e.index];a.selected=!a.selected,this.setData({materialIndex:e.index,materialValue:e.id,materialList:this.data.materialList})},getSelectedItems:function(){for(var t=[],e=0;e<this.data.styleList.length;e++)this.data.styleList[e].selected&&t.push(this.data.styleList[e].dictId);for(var a=[],i=0;i<this.data.categoryList.length;i++)this.data.categoryList[i].selected&&a.push(this.data.categoryList[i].dictId);for(var s=[],d=0;d<this.data.materialList.length;d++)this.data.materialList[d].selected&&s.push(this.data.materialList[d].dictId);return{category:a.length>0?","+a.join(",")+",":"",style:t.length>0?","+t.join(",")+",":"",material:s.length>0?","+s.join(",")+",":""}},clearSelectedItems:function(){for(var t=0;t<this.data.styleList.length;t++)this.data.styleList[t].selected=!1;for(var e=0;e<this.data.categoryList.length;e++)this.data.categoryList[e].selected=!1;for(var a=0;a<this.data.materialList.length;a++)this.data.materialList[a].selected=!1;this.setData({styleList:this.data.styleList,categoryList:this.data.categoryList,materialList:this.data.materialList})},bindConfirmTap:function(){this.getGoodsList(1),this.setData({isShowFilter:!1})},bindResetTap:function(){this.clearSelectedItems(),this.getGoodsList(1),this.setData({isShowFilter:!1})},bindFilterTap:function(){this.setData({isShowFilter:!0})},toDetailsTap:function(t){app.redirect("/pages/goods/details/index?id="+t.currentTarget.dataset.id,"navigateTo")},onReachBottom:function(){if(this.data.currentPage>=this.data.lastPage)return app.showToast("已经最后一页","none");this.getGoodsList(++this.data.currentPage)},onLoad:function(){this.getCategoryList(),this.getStyleList(),this.getMaterialList(),this.getGoodsList(1)},addShopFavorite:function(t){var e=this,a=t.currentTarget.dataset.id;app.wxRequest("/user/saveCollection",{cid:a},function(t){1==t.code&&(e.data.goods.forEach(function(t){t.cid==a&&(t.collection=1)}),e.setData({goods:e.data.goods}))})},removeShopFavorite:function(t){var e=this,a=t.currentTarget.dataset.id;app.wxRequest("/user/cancelCollection",{cid:a},function(t){1==t.code&&(e.data.goods.forEach(function(t){t.cid==a&&(t.collection=2)}),e.setData({goods:e.data.goods}))})},getGoodsList:function(t){var e=this,a=e.getSelectedItems();a.page=t||1,app.wxRequest("/commodity/index",a,function(t){var i=t.data;1==t.code?1==a.page?e.setData({goods:i.list,lastPage:i.lastPage,currentPage:i.currentPage}):e.setData({goods:e.data.goods.concat(i.list),lastPage:i.lastPage,currentPage:i.currentPage}):e.setData({goods:[],lastPage:0,currentPage:1})})}});