"use strict";var app=getApp(),utils=require("../../../utils/util.js");Page({data:{goodsListId:[],goodsList:[],allGoodsPrice:0,userInfo:{},reserveDate:[],reserveDateValue:"",reserveTime:[],reserveTimeStart:"",reserveTimeEnd:""},getWardrobeList:function(){var e=this;app.wxRequest("/device/devices",{},function(t){var r=new Date,a=r.getTime()+1728e5;if(1==t.code){var i=t.data.list[0];e.setData({wardrobeInfo:i,reserveDate:[utils.formatDate(r),utils.formatDate(new Date(a))],reserveTime:[i.startTime,i.endTime],reserveDateValue:utils.formatDate(r),reserveTimeStart:i.startTime,reserveTimeEnd:i.startTime})}})},bindDateChange:function(e){this.setData({reserveDateValue:e.detail.value})},bindStartTimeChange:function(e){this.setData({reserveTimeStart:e.detail.value})},bindEndTimeChange:function(e){this.setData({reserveTimeEnd:e.detail.value})},onLoad:function(){var e=this,t=[],r=app.getCookie("shopOrderInfo");r&&r.shopList&&(t=r.shopList.filter(function(e){return e.active}));for(var a=0,i=[],s=0;s<t.length;s++){var d=t[s];a+=d.price*d.number,i.push(t[s].scid)}e.setData({goodsList:t,goodsListId:i,allGoodsPrice:a}),e.getWardrobeList()},createOrder:function(){var e=this,t={reserveStartTime:e.data.reserveDateValue+" "+e.data.reserveTimeStart+":00",reserveEndTime:e.data.reserveDateValue+" "+e.data.reserveTimeEnd+":00",did:e.data.wardrobeInfo.did,scids:e.data.goodsListId.join(",")};app.wxRequest("/order/saveReserveOrder",t,function(e){1==e.code&&(app.clearCookie("shopOrderInfo"),app.redirect("/page/user/reserve/index","navigateTo"))})}});