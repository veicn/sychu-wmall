"use strict";var app=getApp(),utils=require("../../../utils/util.js");Page({data:{goodsListId:[],goodsList:[],allGoodsPrice:0,userInfo:{},reserveDate:[],reserveDateValue:"",reserveTime:[],reserveTimeStart:"",reserveTimeEnd:""},getWardrobeList:function(){var e=this;app.wxRequest("/device/devices",{},function(t){var a=new Date,r=a.getTime()+1728e5;if(1==t.code){var s=t.data.list[0];e.setData({wardrobeInfo:s,reserveDate:[utils.formatDate(a),utils.formatDate(new Date(r))],reserveTime:[s.startTime,s.endTime],reserveDateValue:utils.formatDate(a),reserveTimeStart:s.startTime,reserveTimeEnd:s.startTime})}})},getUserInfo:function(){var e=this;app.wxRequest("/user/userCenter",{},function(t){e.setData({userInfo:t.data}),e.data.userInfo.couponCount>0&&(e.setData({hasNoCoupons:!1,couponCount:e.data.userInfo.couponCount}),e.getUserCouponsList()),e.data.userInfo.point>0&&e.setData({hasNoPoint:!1,point:e.data.userInfo.point})})},bindDateChange:function(e){this.setData({reserveDateValue:e.detail.value})},bindStartTimeChange:function(e){this.setData({reserveTimeStart:e.detail.value})},bindEndTimeChange:function(e){this.setData({reserveTimeEnd:e.detail.value})},onLoad:function(){var e=this,t=[],a=app.getCookie("shopOrderInfo");a&&a.shopList&&(t=a.shopList.filter(function(e){return e.active}));for(var r=0,s=[],i=0;i<t.length;i++){var o=t[i];r+=o.price*o.number,s.push(t[i].scid)}e.setData({goodsList:t,goodsListId:s,allGoodsPrice:r}),e.getUserInfo(),e.getWardrobeList()},createOrder:function(){var e=this,t={reserveStartTime:e.data.reserveDateValue+" "+e.data.reserveTimeStart+":00",reserveEndTime:e.data.reserveDateValue+" "+e.data.reserveTimeEnd+":00",did:e.data.wardrobeInfo.did,scids:e.data.goodsListId.join(",")};app.wxRequest("/order/saveReserveOrder",t,function(e){1==e.code&&(app.clearCookie("shopOrderInfo"),app.redirect("/page/user/reserve/index"))})}});