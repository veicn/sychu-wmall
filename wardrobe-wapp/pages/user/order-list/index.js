"use strict";var app=getApp();Page({data:{lastPage:0,currentPage:1,orderList:null},onReachBottom:function(){if(this.data.currentPage>=this.data.lastPage)return app.showToast("已经最后一页","none");this.orderList(++this.data.currentPage)},orderDetail:function(t){var a=t.currentTarget.dataset.id;app.redirect("/pages/user/order-details/index?id="+a,"navigateTo")},cancelOrderTap:function(t){var a=this,e=t.currentTarget.dataset.id;wx.showModal({title:"确定要取消该订单吗？",content:"",success:function(t){t.confirm&&app.wxRequest("/order/cancelOrder",{oid:e},function(t){1==t.code?(app.showToast("取消订单成功","success"),a.orderList(1)):app.showToast("取消订单失败","none")})}})},toPayTap:function(t){var a=t.currentTarget.dataset.id;app.wxPay(a,"/pages/user/order-list/index")},orderList:function(t){var a=this;t=t||1,app.wxRequest("/order/userOrders",{page:t},function(e){var r=e.data;1==e.code?1==t?a.setData({orderList:r.list,lastPage:r.lastPage,currentPage:r.currentPage}):a.setData({orderList:a.data.orderList.concat(r.list),lastPage:r.lastPage,currentPage:r.currentPage}):a.setData({orderList:null,lastPage:0,currentPage:1})})},onLoad:function(){this.orderList(1)}});